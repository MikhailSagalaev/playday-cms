# üìä Metabase - GUI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö PlayDay CMS

## üöÄ –ó–∞–ø—É—Å–∫ Metabase

Metabase —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —á–µ—Ä–µ–∑ Docker Compose. –î–ª—è –∑–∞–ø—É—Å–∫–∞:

```bash
cd /opt/metabase
docker-compose up -d
```

**–î–æ—Å—Ç—É–ø –∫ Metabase:** `http://62.109.26.35:3001`

## üîß –ü–µ—Ä–≤–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ Metabase –ø–æ–ø—Ä–æ—Å–∏—Ç —Å–æ–∑–¥–∞—Ç—å —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

- **Email:** admin@play-day.ru
- **–ü–∞—Ä–æ–ª—å:** –°–æ–∑–¥–∞–π—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å
- **–ò–º—è –∫–æ–º–ø–∞–Ω–∏–∏:** PlayDay

### 2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL

–ù–∞ —à–∞–≥–µ "Add your data":

1. **Database type:** PostgreSQL
2. **Name:** PlayDay CMS
3. **Host:** 
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ: `host.docker.internal`
   - –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: `172.17.0.1` (IP —Ö–æ—Å—Ç–∞ –≤ Docker bridge network)
   - –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: —É–∑–Ω–∞–π—Ç–µ IP –∫–æ–º–∞–Ω–¥–æ–π `ip addr show docker0`
4. **Port:** `5432`
5. **Database name:** `playday_cms`
6. **Database username:** `playday`
7. **Database password:** –í–∞—à –ø–∞—Ä–æ–ª—å –∏–∑ `.env` —Ñ–∞–π–ª–∞
8. **Additional JDBC connection string options:** (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º)

–ù–∞–∂–º–∏—Ç–µ **Save**.

### 3. –ï—Å–ª–∏ Metabase –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** `Connection refused` –∏–ª–∏ `Host unreachable`

**–†–µ—à–µ–Ω–∏–µ 1 - –†–∞–∑—Ä–µ—à–∏—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å Docker:**

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ pg_hba.conf
sudo nano /etc/postgresql/15/main/pg_hba.conf

# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É (–∑–∞–º–µ–Ω–∏—Ç–µ 172.17.0.0/16 –Ω–∞ –≤–∞—à—É Docker —Å–µ—Ç—å):
host    playday_cms     playday         172.17.0.0/16           md5

# –û—Ç–∫—Ä–æ–π—Ç–µ postgresql.conf
sudo nano /etc/postgresql/15/main/postgresql.conf

# –ù–∞–π–¥–∏—Ç–µ –∏ –∏–∑–º–µ–Ω–∏—Ç–µ:
listen_addresses = '*'

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL
sudo systemctl restart postgresql
```

**–†–µ—à–µ–Ω–∏–µ 2 - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ host network mode (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ docker-compose.yml):**

```yaml
network_mode: host
```

–° —ç—Ç–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `localhost` –∏–ª–∏ `127.0.0.1` –∫–∞–∫ —Ö–æ—Å—Ç.

## üìä –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Metabase

### 1. –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–∞–±–ª–∏—Ü

–ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Browse Data** ‚Üí **PlayDay CMS** ‚Üí **locations**

–í—ã —É–≤–∏–¥–∏—Ç–µ –≤—Å–µ –∑–∞–ø–∏—Å–∏ –≤ —É–¥–æ–±–Ω–æ–º —Ç–∞–±–ª–∏—á–Ω–æ–º –≤–∏–¥–µ.

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤ (Questions)

**–ü—Ä–∏–º–µ—Ä: –°–∫–æ–ª—å–∫–æ –ª–æ–∫–∞—Ü–∏–π –≤ –±–∞–∑–µ?**

1. –ù–∞–∂–º–∏—Ç–µ **New** ‚Üí **Question**
2. –í—ã–±–µ—Ä–∏—Ç–µ **Simple question**
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É **locations**
4. –í **Summarize** –≤—ã–±–µ—Ä–∏—Ç–µ **Count**
5. –ù–∞–∂–º–∏—Ç–µ **Visualize**
6. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤–æ–ø—Ä–æ—Å

**–ü—Ä–∏–º–µ—Ä: –õ–æ–∫–∞—Ü–∏–∏ —Å –∏—Ö email**

1. **New** ‚Üí **Question** ‚Üí **Simple question**
2. –¢–∞–±–ª–∏—Ü–∞ **locations**
3. –í —Å—Ç–æ–ª–±—Ü–∞—Ö –≤—ã–±–µ—Ä–∏—Ç–µ: `–Ω–∞–∑–≤–∞–Ω–∏–µ`, `email`, `–∞–¥—Ä–µ—Å`, `created_at`
4. **Visualize**

### 3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

Metabase **–Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö**. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

- **Adminer** (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –µ—Å–ª–∏ –≤—ã —Å–ª–µ–¥–æ–≤–∞–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º)
- **pgAdmin**
- –ò–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —á–µ—Ä–µ–∑ API

### 4. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–æ–≤

1. **New** ‚Üí **Dashboard**
2. –î–∞–π—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: "–û–±–∑–æ—Ä –ª–æ–∫–∞—Ü–∏–π"
3. –î–æ–±–∞–≤—å—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

1. **Settings** (‚öôÔ∏è) ‚Üí **Admin** ‚Üí **People**
2. **Add someone** ‚Üí –≤–≤–µ–¥–∏—Ç–µ email
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å:
   - **Admin** - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
   - **Standard** - –ø—Ä–æ—Å–º–æ—Ç—Ä –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤
   - **View-only** - —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–∞–º

1. **Settings** ‚Üí **Admin** ‚Üí **Permissions**
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ, –∫–∞–∫–∏–µ –≥—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–∫–∏–º —Ç–∞–±–ª–∏—Ü–∞–º

## üìà –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è PlayDay

### –í—Å–µ –ª–æ–∫–∞—Ü–∏–∏ —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏

```sql
SELECT 
  –Ω–∞–∑–≤–∞–Ω–∏–µ, 
  email, 
  –Ω–æ–º–µ—Ä_—Ç–µ–ª–µ—Ñ–æ–Ω–∞, 
  –∞–¥—Ä–µ—Å,
  created_at,
  updated_at
FROM locations
ORDER BY created_at DESC;
```

### –õ–æ–∫–∞—Ü–∏–∏ —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –ø—Ä–∏–∑–∞–º–∏

```sql
SELECT 
  –Ω–∞–∑–≤–∞–Ω–∏–µ,
  –ø—Ä–∏–∑_1_—Ç–µ–∫—Å—Ç,
  –ø—Ä–∏–∑_2_—Ç–µ–∫—Å—Ç,
  –ø—Ä–∏–∑_3_—Ç–µ–∫—Å—Ç
FROM locations
WHERE –ø—Ä–∏–∑_1_—Ç–µ–∫—Å—Ç IS NOT NULL;
```

### –¶–µ–Ω—ã —Ç–∞–π–º-–∫–∞—Ä—Ç –ø–æ –ª–æ–∫–∞—Ü–∏—è–º

```sql
SELECT 
  –Ω–∞–∑–≤–∞–Ω–∏–µ,
  —Ç–∞–π–º_–∫–∞—Ä—Ç–∞_1_—á–∞—Å_—Ü–µ–Ω–∞,
  —Ç–∞–π–º_–∫–∞—Ä—Ç–∞_2_—á–∞—Å–∞_—Ü–µ–Ω–∞,
  —Ç–∞–π–º_–∫–∞—Ä—Ç–∞_3_—á–∞—Å–∞_—Ü–µ–Ω–∞,
  —Ç–∞–π–º_–∫–∞—Ä—Ç–∞_4_—á–∞—Å–∞_—Ü–µ–Ω–∞,
  —Ç–∞–π–º_–∫–∞—Ä—Ç–∞_5_—á–∞—Å–æ–≤_—Ü–µ–Ω–∞
FROM locations
WHERE —Ç–∞–π–º_–∫–∞—Ä—Ç–∞_1_—á–∞—Å_—Ü–µ–Ω–∞ IS NOT NULL;
```

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Metabase

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
cd /opt/metabase
docker-compose ps
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
docker-compose down
```

### –ó–∞–ø—É—Å–∫

```bash
docker-compose up -d
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
docker-compose logs -f metabase
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Metabase

```bash
docker-compose pull
docker-compose up -d
```

## üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Adminer

–ï—Å–ª–∏ Metabase –∫–∞–∂–µ—Ç—Å—è —Å–ª–æ–∂–Ω—ã–º, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Adminer –¥–ª—è –ø—Ä—è–º–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Adminer:**

```bash
cd /opt
sudo mkdir adminer
cd adminer

# –°–∫–∞—á–∞–π—Ç–µ Adminer
sudo wget https://github.com/vrana/adminer/releases/download/v4.8.1/adminer-4.8.1.php -O index.php

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx
sudo nano /etc/nginx/sites-available/adminer

# –î–æ–±–∞–≤—å—Ç–µ:
server {
    listen 3002;
    server_name _;
    root /opt/adminer;
    index index.php;
    
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
    }
}

# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ
sudo ln -s /etc/nginx/sites-available/adminer /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PHP-FPM
sudo apt install php-fpm php-pgsql -y
```

**–î–æ—Å—Ç—É–ø –∫ Adminer:** `http://62.109.26.35:3002`

**–í—Ö–æ–¥:**
- System: PostgreSQL
- Server: localhost
- Username: playday
- Password: –≤–∞—à –ø–∞—Ä–æ–ª—å
- Database: playday_cms

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs -f metabase`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL: `psql -h localhost -U playday -d playday_cms`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Docker —Å–µ—Ç—å: `docker network ls` –∏ `docker network inspect bridge`
